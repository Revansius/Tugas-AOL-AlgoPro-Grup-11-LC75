// sistem restoran
#include <stdio.h>
#include <string.h>
#include <stdlib.h>
#include <ctype.h>

//Admin
#define admin_username "Admin"
#define admin_password "#Admin123"


// STRUCT
struct Menu {
    int id;
    char nama[30];
    int harga;
    int stok;
};

struct KeranjangItem {
    char nama[39];
    int quantity;
    int subtotal;
};

struct KeranjangItem keranjang [50];
int keranjangCount = 0;
int totalPembayaran1 = 0;
int isAdminLoggin = 0;

struct Menu appetizer[50] = {
    {1, "Garlic Cheese Bread", 20000, 30},
    {2, "French Fries", 20000, 30},
    {3, "Chicken Wing", 27000, 30},
    {4, "Oyster", 35000, 30},
    {5, "Salad", 15000, 30}
};

struct Menu mainCourse[50] = {
    {1, "Nasi Goreng", 50000, 10},
    {2, "Salted Egg Chicken", 65000, 10},
    {3, "Spaghetti Carbonara", 70000, 10},
    {4, "Beef Steak", 105000, 10},
    {5, "Chicken Katsu Curry", 80000, 10}
};

struct Menu beverages[50] = {
    {1, "Avochoco", 35000, 10},
    {2, "Lychee Tea", 25000, 10},
    {3, "Lemon Cocktail", 50000, 10},
    {4, "Biscoff Espresso", 45000, 10},
    {5, "Chocolate", 30000, 10}
};

struct Menu dessert[50] = {
    {1, "Burnt Cheesecake", 35000, 10},
    {2, "Choco Lava", 25000, 10},
    {3, "Panacotta", 20000, 10},
    {4, "Pancake Lotus Ice Cream", 40000, 10},
    {5, "Trio Ice Cream", 30000, 10}
};

// FUCNTION
void simpanStokKeFile() {
    FILE *fp = fopen("stock.txt", "w");
    if (fp == NULL) {
        printf("Gagal membuka file untuk menyimpan stok!\n");
        return;
    }
    
    struct Menu *semuaMenu[] = {appetizer, mainCourse, beverages, dessert};
    for (int i = 0; i < 4; i++) {
        for (int j = 0; j < 5; j++) {
            fprintf(fp, "%d\n", semuaMenu[i][j].stok);
        }
    }
    fclose(fp);
}

void muatStokDariFile() {
    FILE *fp = fopen("stock.txt", "r");
    if (fp == NULL) {
        simpanStokKeFile();
        return;
    }

    struct Menu *semuaMenu[] = {appetizer, mainCourse, beverages, dessert};
    for (int i = 0; i < 4; i++) {
        for (int j = 0; j < 5; j++) {
            if (fscanf(fp, "%d", &semuaMenu[i][j].stok) == EOF) break;
        }
    }
    fclose(fp);
}



void tampilMenu(struct Menu menu[], int jumlah, char judul[]) {
    printf("\n== %s ==\n", judul);
    printf("-------------------------------------------------------------\n");

    for (int i = 0; i < jumlah; i++) {
        printf("%-4d | %-25s | %-11d | %-5d\n",
               menu[i].id,
               menu[i].nama,
               menu[i].harga,
               menu[i].stok);
    }

    printf("-------------------------------------------------------------\n");

}


void clear_stdin(){
    int c;
    while ((c == getchar()) != '\n' && c != EOF){

	}
}

void menu_admin(){
printf("\n===Menu Admin===\n");
printf("1. Tampilkan Menu\n");
printf("2. Update Stock\n");
printf("3. Tambah Menu Baru\n");
printf("4. Hapus Menu\n");
printf("5. Riwayat Transaksi\n");
printf("6. Logout Admin\n");
printf("Pilih: ");
}

void MenuUtama(){
	printf("Silahkan Pilih Jenis Menu yang Anda Ingin Pesan\n");
    printf("1. Appetizer\n");
    printf("2. Main Course\n");
    printf("3. Beverages\n");
    printf("4. Dessert\n");
    printf("5. Pembayaran\n");
    printf("6. Exit\n");
    printf("Choose : ");
}


void Display() {
    char nama[50], email[50];
    int people, meja;
	char password[50];

    printf("==========================================\n");
    printf("      Selamat Datang di Trouville\n");
    printf("==========================================\n");

    printf("Nama          : ");
    scanf(" %[^\n]", nama);
if(strcmp(nama, admin_username)== 0){
printf("Password\n");
scanf(" %[^\n]", password);

if(strcmp(password, admin_password)==0){
printf("=======================\n");
printf("Loggin Admin Berhasil\n");
printf("=======================\n");
isAdminLoggin = 1;
return;
} else {  
printf("Password Salah?  Anda Penyusup?\n");
isAdminLoggin = 0;
    printf("Email         : ");
    scanf(" %[^\n]", email);

    printf("Jumlah Orang  : ");
    scanf("%d", &people);

    printf("No Meja       : ");
    scanf("%d", &meja);

    printf("==========================================\n");
}
} else {
isAdminLoggin = 0;
printf("Email         : ");
    scanf(" %[^\n]", email);

    printf("Jumlah Orang  : ");
    scanf("%d", &people);

    printf("No Meja       : ");
    scanf("%d", &meja);

    printf("==========================================\n");
}

void TampilkanMenuAdmin(){
printf("====Menu Trouville====\n");
tampilMenu(appetizer, 5, "APPETIZER");
tampilMenu(mainCourse, 5, "MAIN COURSE");
tampilMenu(beverages, 5, "BEVERAGES");
tampilMenu(dessert, 5, "DESSERT");
}

	void UpdateStock(){
int kategori, id, stockbaru;

printf("\n====Update Stock Menu===\n");
printf("Pilih Kategori:\n");
printf("1. Appertizer\n");
printf("2. Main Course\n");
printf("3. Beverage\n");
printf("4. Dessert\n");
printf("Pilih: ");
scanf("%d", &kategori);

struct Menu *menuDipilih;
char namaKategori[20];

switch ( kategori){
case 1:
menuDipilih = appetizer;
strcpy(namaKategori, "Appetizer");
break;
case 2:
menuDipilih = mainCourse;
strcpy(namaKategori, "Main Course");
break;
case 3:
menuDipilih = beverages;
strcpy(namaKategori, "Beverage");
break;
case 4:
menuDipilih = dessert;
strcpy(namaKategori, "Dessert");
break;
default: 
printf("Menu tidak valid\n");
return;
}
tampilMenu(menuDipilih, 5,namaKategori);

printf("Masukkan menu yang akan diupdate: ");
scanf("%d", &id);

if(id < 1 || id > 5){
printf("Menu tidak Valid!\n");
return;
}

printf("Stock saat ini: %d", menuDipilih[id-1].stok);
printf("Masukkan Stock Baru: ");
scanf("%d", &stockbaru);

if(stockbaru < 0){
printf("Input harus positif!\n");
return;
}

menuDipilih[id-1].stok = stockbaru;
simpanStockFile();
printf("Stock sudah diupdate\n");
}

void orderMenu(struct Menu menu[], int jumlah){
    int pilih, quantity;

    printf("Pilih angka 0 untuk kembali\n");
    printf("Masukkan No. pesanan: \n");
    scanf("%d", &pilih);
    
    if(pilih == 0) return;

    int idx = -1;
    for (int i = 0; i < jumlah; i++) {
        if(menu[i].id == pilih){
            idx = i;
            break;
        }
    }

    if(idx == -1){
        printf("Pilihan Invalid.\n");
        return;
    }

    printf("Jumlah yang pesanan %s: \n", menu[idx].nama);
    scanf("%d", &quantity);

    if(quantity <= 0){
        printf("Jumlah pesanan harus lebih dari 0\n");
        return;
    }

    if(menu[idx].stok >= quantity){
        menu[idx].stok -= quantity;

        simpanStokKeFile(); 

        strcpy(keranjang[keranjangCount].nama, menu[idx].nama);
        keranjang[keranjangCount].quantity = quantity;
        keranjang[keranjangCount].subtotal = quantity * menu[idx].harga;

        totalPembayaran1 += keranjang[keranjangCount].subtotal;
        keranjangCount++;

        printf("Pesanan anda berhasil\n");
    } else {
        printf("Mohon maaf stok menu yang anda pilih tidak mencukupi\n");
    }
}

	void tambahmenu(){
int kategori;
printf("\n===Tambah Menu Baru===\n");
printf("Pilih kategori\n");
printf("1. Appertizer\n");
printf("2. Main COurse\n");
printf("3. Beverages\n");
printf("4. Dessert\n");
printf("Pilih: ");
scanf("%d", kategori);

struct Menu * menuDipilih;
char namaKategori[20];
int *count;

switch(kategori){
case 1: 
menuDipilih = appetizer;
strcpy(namaKategori, "Appetizer");
count = &appetizerCount;
break;
case 2:
menuDipilih = main course;
strcpy(namaKategori. "Main Course");
count = &mainCourseCount;
break;
case 3:
menuDipilih = beverages;
strcpy(namaKategori, "Beverages");
count = &beveragesCount;
break;
case 4:
menuDipilih = dessert;
strcpy(namaKategori, "Dessert");
count = &dessertCount;
break;
default:
printf("Kategori tidak valid\n");
return;
}

printf("\nMasukkan Menu Baru:\n");

printf("Nama Menu: ");
clearInputBuffer();
scanf("%[^\n]", menuDipilih[*count].nama);
printf("Harga Awal: ");
scanf("%d", &menuDipilih[*count].harga);
printf("Stock Awal: ");
scanf("%d", &menuDipilih[*count].stok);

(*count)++;
simpanStockKeFile();
return;
printf("Menu sudah berhasil ditambahkan  ke kategori %s\n", namaKategori);
}




	void hapusmenu(){
int kategori, id;

printf("\n===Pilih Menu yang akan dihapus===\n");
printf("1. Appetizer\n");
printf("2. Main Course\n");
printf("3. beverages\n");
printf("4. Dessert\n");
printf("Pilih: ");
scanf("%d", &kategori);

struct Menu*menuDipilih;
char namaKategori[20];
int *count;

switch (kategori){
case 1:
menuDipilih = appetizer;
strcpy(namaKategori, "Appetizer");
count = &appetizerCount;
break;
case 2:
menuDipilih = main course;
strcpy(namaKategori, "Main Course");
count = &mainCourseCount;
break;
case 3:
menuDipilih = beverages;
strcpy(namaKategori, "Beverages");
break;
case 4:
menuDipilih = dessert;
strcpy(namaKategori, "Dessert");
break;
default: 
printf("kategori tidak valid\n");
return;
}
if(count == 0){
printf("Kategori %s kosong!Tidak ada menu yang bisa dihapus!\n");
return;
}
scanf("%d", &id");
tampilMenu(menuDipilih, *count, namaKategori);
printf("Masukkan ID menu yang akan dihapus: ");
scanf("%d", &id);
if(id < 1 || id > *count){
printf("ID tidak valid");
return;
}

printf("\nMenu yang akan dihapus: ");
printf("Nama :%s\n", menuDipilih[id-1].nama);
printf("Harga :Rp%d\n", menuDipilih[id=1].harga);
printf("Stock :%d\n", menuDipilih[id=1].stock);

char konfirmasi;
printf("Yakin ingin menghapus menu ini? (y/n): ");
clearInputBuffer();
scanf("%c", &konfirmasi);

if(konfirmasi == 'y' || konfirmasi == 'Y'){
for (int i = id-1; i < *count - 1;i++){
menuDipilih[i] = menuDipilih[i+1];
menuDipilih[i].id = i + 1;
}
(*count)--;
simpanStockFile();
printf("mneu berhasil dihapus\n");
}else {
printf("Penghapusan dibatalkan\n");
}

	void riwayattransaksi(){
printf("\n===Lihat riwayat transaksi===\n");
File *fp= fopen("transaksi.txt", "r");
if(fp == NULL){
printf("belum ada riwayat transaksi.\n");
return;
}
char buffer[300];
while (fgets (buffer, sizeof(buffer), fp){
printf("%s", &buffer);
} else {
fclose(fp);
}

	

void strukPembayaran(){
    if(keranjangCount == 0){
        printf("Belum ada pesanan\n");
    }
    printf("=============================================================\n");
    printf("                    TROUVILLE RESTAURANT\n");
    printf("=============================================================\n");
    printf("%-4s | %-20s | %-12s\n", "Item", "Quantity", "Subtotal");
    printf("-------------------------------------------------------------\n");
    for(int i = 0;i < keranjangCount;i++){
        printf("%-4d | %-20s | %-11d | %-5d\n",
               i+1,
               keranjang[i].nama,
               keranjang[i].quantity,
               keranjang[i].subtotal);
    }
    printf("-------------------------------------------------------------\n");
    printf("Total Pembayaran :  Rp%d\n", totalPembayaran1);
    printf("-------------------------------------------------------------\n");
}

// MAIN
int main(){
    muatStokDariFile();
    int pilihMenu;
    Display();
 if (isadminLoggin){
    do {
         menu_admin();
scanf("%d", &pilihMenu)
        scanf("%d", &pilihMenu);
     clearInputBuffer();
      
	switch(pilihMenu){
case 1:
TampilkanMenuAdmin();
break;
case 2:
UpdateStock();
break;
case 3:
tambahmenu();
break;
case 4:
hapusmenu();
break;
case 5:
riwayattransaksi();
break;
case 6:
printf("Kembali ke mode costumer\n");
isAdminLoggin = 0;
Display();
break;
case 7:
return 0;
default:
printf("Tidak valid\n");
}
}while (pilihMenu != 6); 
return 0;
}





  MenuUtama();
        scanf("%d", &pilihMenu);

        switch(pilihMenu){
            case 1: 
                tampilMenu(appetizer, 5, "APPETIZER");
                orderMenu(appetizer, 5);
                break;
            case 2:
                tampilMenu(mainCourse, 5, "MAIN COURSE");
                orderMenu(mainCourse, 5);
                break;
            case 3:
                tampilMenu(beverages, 5, "BEVERAGES");
                orderMenu(beverages, 5);
                break;
            case 4:
                tampilMenu(dessert, 5, "DESSERT");
                orderMenu(dessert, 5);
                break;
            case 5:
                strukPembayaran();
                break;
            case 6:
                printf("Terima Kasih!\n");
                return 0;
            default:
                printf("Pilihan tidak valid!\n");


        }
    }while (pilihMenu != 6);



    
    
    
    return 0;
}
